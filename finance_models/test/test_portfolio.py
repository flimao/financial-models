import datetime as dt
import numpy as np
import pandas as pd
from .. import portfolio, tools
import unittest

import warnings
warnings.filterwarnings('ignore')

class TestPortfolio(unittest.TestCase):
    def setUp(self):
        self.date_idx = pd.date_range(
            start = dt.date(2022, 1, 1),
            end = dt.date(2022, 1, 7),
            freq = 'D'
        )

        self.sec_names = [ 'S1', 'S2', 'S3' ]
        
        self.secs_values = pd.DataFrame(
            [
                [11.1349419, 12.45459113, 11.65418345],
                [9.300009683, 11.88696042, 12.5906423],
                [11.65175549, 7.504452931, 13.04502693],
                [9.275835792, 8.429503342, np.nan],
                [12.31792534, 11.90068811, 13.34205007],
                [11.03412628, 11.80362515, 14.05605982],
                [10.81213237, 12.10794911, 14.17710639],
            ],
            columns = self.sec_names,
            index = self.date_idx
        )

    def test_portfolio_notionals_int(self):
        pf = portfolio.Portfolio(
            securities_values = self.secs_values,
            notionals = 1000
        )

        pf_mean = tools.Money(pf.portfolio_total.mean())
        pf_mean_expected = tools.Money(32925.65)          # calculations in Excel

        self.assertAlmostEqual(
            pf_mean, pf_mean_expected, places = None, delta = 0.01,
            msg = f"Wrong average portfolio total. Expected {pf_mean_expected}, got {pf_mean}"
        )
    
    def test_portfolio_notionals_series(self):
        notionals = pd.Series(
            [1500, 2000, 500],
            index = self.sec_names,
        )
        
        pf = portfolio.Portfolio(
            securities_values = self.secs_values,
            notionals = notionals
        )

        pf_mean = tools.Money(pf.portfolio_total.mean())
        pf_mean_expected = tools.Money(43556.88)           # calculations in Excel

        self.assertAlmostEqual(
            pf_mean, pf_mean_expected, places = None, delta = 0.01,
            msg = f"Wrong average portfolio total. Expected {pf_mean_expected}, got {pf_mean}"
        )
    
    def test_portfolio_notionals_df(self):
        notionals = pd.DataFrame(
            [[1500, 2000, 500], [2000, 1500, 600]],
            columns = self.sec_names,
            index = self.date_idx[[0, 2]],
        )
        
        pf = portfolio.Portfolio(
            securities_values = self.secs_values,
            notionals = notionals
        )

        pf_mean = tools.Money(pf.portfolio_total.mean())
        pf_mean_expected = tools.Money(44576.14)          # calculations in Excel

        self.assertAlmostEqual(
            pf_mean, pf_mean_expected, places = None, delta = 0.01,
            msg = f"Wrong average portfolio total. Expected {pf_mean_expected}, got {pf_mean}"
        )

    def test_portfolio_notionals_dropna(self):
        notionals = 1000
        secs_values = self.secs_values.copy()
        secs_values.loc['2022-01-04'] = np.nan
        
        pf = portfolio.Portfolio(
            securities_values = secs_values,
            notionals = notionals,
            na = 'drop',
        )

        pf_mean = tools.Money(pf.portfolio_total.mean())
        pf_mean_expected = tools.Money(35462.37)          # calculations in Excel

        self.assertAlmostEqual(
            pf_mean, pf_mean_expected, places = None, delta = 0.01,
            msg = f"Wrong average portfolio total. Expected {pf_mean_expected}, got {pf_mean}"
        )

    def test_portfolio_notionals_ffillna(self):
        notionals = 1000
        
        pf = portfolio.Portfolio(
            securities_values = self.secs_values,
            notionals = notionals,
            na = 'ffill',
        )

        pf_mean = tools.Money(pf.portfolio_total.mean())
        pf_mean_expected = tools.Money(34789.23)          # calculations in Excel

        self.assertAlmostEqual(
            pf_mean, pf_mean_expected, places = None, delta = 0.01,
            msg = f"Wrong average portfolio total. Expected {pf_mean_expected}, got {pf_mean}"
        )
    
    def test_portfolio_notionals_bfillna(self):
        notionals = 1000
        
        pf = portfolio.Portfolio(
            securities_values = self.secs_values,
            notionals = notionals,
            na = 'bfill',
        )

        pf_mean = tools.Money(pf.portfolio_total.mean())
        pf_mean_expected = tools.Money(34831.66)          # calculations in Excel

        self.assertAlmostEqual(
            pf_mean, pf_mean_expected, places = None, delta = 0.01,
            msg = f"Wrong average portfolio total. Expected {pf_mean_expected}, got {pf_mean}"
        )


class TestOptimization(unittest.TestCase):
    def setUp(self):
        self.date_idx = pd.DatetimeIndex(
            [
                '2021-03-10 00:00:00',
                '2021-03-11 00:00:00',
                '2021-03-12 00:00:00',
                '2021-03-15 00:00:00',
                '2021-03-16 00:00:00',
                '2021-03-17 00:00:00',
                '2021-03-18 00:00:00',
                '2021-03-19 00:00:00',
                '2021-03-22 00:00:00',
                '2021-03-23 00:00:00',
                '2021-03-24 00:00:00',
                '2021-03-25 00:00:00',
                '2021-03-26 00:00:00',
                '2021-03-29 00:00:00',
                '2021-03-30 00:00:00',
                '2021-03-31 00:00:00',
                '2021-04-01 00:00:00',
                '2021-04-05 00:00:00',
                '2021-04-06 00:00:00',
                '2021-04-07 00:00:00',
                '2021-04-08 00:00:00',
                '2021-04-09 00:00:00',
                '2021-04-12 00:00:00',
                '2021-04-13 00:00:00',
                '2021-04-14 00:00:00',
                '2021-04-15 00:00:00',
                '2021-04-16 00:00:00',
                '2021-04-19 00:00:00',
                '2021-04-20 00:00:00',
                '2021-04-22 00:00:00',
                '2021-04-23 00:00:00',
                '2021-04-26 00:00:00',
                '2021-04-27 00:00:00',
                '2021-04-28 00:00:00',
                '2021-04-29 00:00:00',
                '2021-04-30 00:00:00',
                '2021-05-03 00:00:00',
                '2021-05-04 00:00:00',
                '2021-05-05 00:00:00',
                '2021-05-06 00:00:00',
                '2021-05-07 00:00:00',
                '2021-05-10 00:00:00',
                '2021-05-11 00:00:00',
                '2021-05-12 00:00:00',
                '2021-05-13 00:00:00',
                '2021-05-14 00:00:00',
                '2021-05-17 00:00:00',
                '2021-05-18 00:00:00',
                '2021-05-19 00:00:00',
                '2021-05-20 00:00:00',
                '2021-05-21 00:00:00',
                '2021-05-24 00:00:00',
                '2021-05-25 00:00:00',
                '2021-05-26 00:00:00',
                '2021-05-27 00:00:00',
                '2021-05-28 00:00:00',
                '2021-05-31 00:00:00',
                '2021-06-01 00:00:00',
                '2021-06-02 00:00:00',
                '2021-06-04 00:00:00',
                '2021-06-07 00:00:00',
                '2021-06-08 00:00:00',
                '2021-06-09 00:00:00',
                '2021-06-10 00:00:00',
                '2021-06-11 00:00:00',
                '2021-06-14 00:00:00',
                '2021-06-15 00:00:00',
                '2021-06-16 00:00:00',
                '2021-06-17 00:00:00',
                '2021-06-18 00:00:00',
                '2021-06-21 00:00:00',
                '2021-06-22 00:00:00',
                '2021-06-23 00:00:00',
                '2021-06-24 00:00:00',
                '2021-06-25 00:00:00',
                '2021-06-28 00:00:00',
                '2021-06-29 00:00:00',
                '2021-06-30 00:00:00',
                '2021-07-01 00:00:00',
                '2021-07-02 00:00:00',
                '2021-07-05 00:00:00',
                '2021-07-06 00:00:00',
                '2021-07-07 00:00:00',
                '2021-07-08 00:00:00',
                '2021-07-12 00:00:00',
                '2021-07-13 00:00:00',
                '2021-07-14 00:00:00',
                '2021-07-15 00:00:00',
                '2021-07-16 00:00:00',
                '2021-07-19 00:00:00',
                '2021-07-20 00:00:00',
                '2021-07-21 00:00:00',
                '2021-07-22 00:00:00',
                '2021-07-23 00:00:00',
                '2021-07-26 00:00:00',
                '2021-07-27 00:00:00',
                '2021-07-28 00:00:00',
                '2021-07-29 00:00:00',
                '2021-07-30 00:00:00',
                '2021-08-02 00:00:00',
                '2021-08-03 00:00:00',
                '2021-08-04 00:00:00',
                '2021-08-05 00:00:00',
                '2021-08-06 00:00:00',
                '2021-08-09 00:00:00',
                '2021-08-10 00:00:00',
                '2021-08-11 00:00:00',
                '2021-08-12 00:00:00',
                '2021-08-13 00:00:00',
                '2021-08-16 00:00:00',
                '2021-08-17 00:00:00',
                '2021-08-18 00:00:00',
                '2021-08-19 00:00:00',
                '2021-08-20 00:00:00',
                '2021-08-23 00:00:00',
                '2021-08-24 00:00:00',
                '2021-08-25 00:00:00',
                '2021-08-26 00:00:00',
                '2021-08-27 00:00:00',
                '2021-08-30 00:00:00',
                '2021-08-31 00:00:00',
                '2021-09-01 00:00:00',
                '2021-09-02 00:00:00',
                '2021-09-03 00:00:00',
                '2021-09-06 00:00:00',
                '2021-09-08 00:00:00',
                '2021-09-09 00:00:00',
                '2021-09-10 00:00:00',
                '2021-09-13 00:00:00',
                '2021-09-14 00:00:00',
                '2021-09-15 00:00:00',
                '2021-09-16 00:00:00',
                '2021-09-17 00:00:00',
                '2021-09-20 00:00:00',
                '2021-09-21 00:00:00',
                '2021-09-22 00:00:00',
                '2021-09-23 00:00:00',
                '2021-09-24 00:00:00',
                '2021-09-27 00:00:00',
                '2021-09-28 00:00:00',
                '2021-09-29 00:00:00',
                '2021-09-30 00:00:00',
                '2021-10-01 00:00:00',
                '2021-10-04 00:00:00',
                '2021-10-05 00:00:00',
                '2021-10-06 00:00:00',
                '2021-10-07 00:00:00',
                '2021-10-08 00:00:00',
                '2021-10-11 00:00:00',
                '2021-10-13 00:00:00',
                '2021-10-14 00:00:00',
                '2021-10-15 00:00:00',
                '2021-10-18 00:00:00',
                '2021-10-19 00:00:00',
                '2021-10-20 00:00:00',
                '2021-10-21 00:00:00',
                '2021-10-22 00:00:00',
                '2021-10-25 00:00:00',
                '2021-10-26 00:00:00',
                '2021-10-27 00:00:00',
                '2021-10-28 00:00:00',
                '2021-10-29 00:00:00',
                '2021-11-01 00:00:00',
                '2021-11-03 00:00:00',
                '2021-11-04 00:00:00',
                '2021-11-05 00:00:00',
                '2021-11-08 00:00:00',
                '2021-11-09 00:00:00',
                '2021-11-10 00:00:00',
                '2021-11-11 00:00:00',
                '2021-11-12 00:00:00',
                '2021-11-16 00:00:00',
                '2021-11-17 00:00:00',
                '2021-11-18 00:00:00',
                '2021-11-19 00:00:00',
                '2021-11-22 00:00:00',
                '2021-11-23 00:00:00',
                '2021-11-24 00:00:00',
                '2021-11-25 00:00:00',
                '2021-11-26 00:00:00',
                '2021-11-29 00:00:00',
                '2021-11-30 00:00:00',
                '2021-12-01 00:00:00',
                '2021-12-02 00:00:00',
                '2021-12-03 00:00:00',
                '2021-12-06 00:00:00',
                '2021-12-07 00:00:00',
                '2021-12-08 00:00:00',
                '2021-12-09 00:00:00',
                '2021-12-10 00:00:00',
                '2021-12-13 00:00:00',
                '2021-12-14 00:00:00',
                '2021-12-15 00:00:00',
                '2021-12-16 00:00:00',
                '2021-12-17 00:00:00',
                '2021-12-20 00:00:00',
                '2021-12-21 00:00:00',
                '2021-12-22 00:00:00',
                '2021-12-23 00:00:00',
                '2021-12-27 00:00:00',
                '2021-12-28 00:00:00',
                '2021-12-29 00:00:00',
                '2021-12-30 00:00:00',
                '2022-01-03 00:00:00',
                '2022-01-04 00:00:00',
                '2022-01-05 00:00:00',
                '2022-01-06 00:00:00',
                '2022-01-07 00:00:00',
                '2022-01-10 00:00:00',
                '2022-01-11 00:00:00',
                '2022-01-12 00:00:00',
                '2022-01-13 00:00:00',
                '2022-01-14 00:00:00',
                '2022-01-17 00:00:00',
                '2022-01-18 00:00:00',
                '2022-01-19 00:00:00',
                '2022-01-20 00:00:00',
                '2022-01-21 00:00:00',
                '2022-01-24 00:00:00',
                '2022-01-25 00:00:00',
                '2022-01-26 00:00:00',
                '2022-01-27 00:00:00',
                '2022-01-28 00:00:00',
                '2022-01-31 00:00:00',
                '2022-02-01 00:00:00',
                '2022-02-02 00:00:00',
                '2022-02-03 00:00:00',
                '2022-02-04 00:00:00',
                '2022-02-07 00:00:00',
                '2022-02-08 00:00:00',
                '2022-02-09 00:00:00',
                '2022-02-10 00:00:00',
                '2022-02-11 00:00:00',
                '2022-02-14 00:00:00',
                '2022-02-15 00:00:00',
                '2022-02-16 00:00:00',
                '2022-02-17 00:00:00',
                '2022-02-18 00:00:00',
                '2022-02-21 00:00:00',
                '2022-02-22 00:00:00',
                '2022-02-23 00:00:00',
                '2022-02-24 00:00:00',
                '2022-02-25 00:00:00',
                '2022-03-02 00:00:00',
                '2022-03-03 00:00:00',
                '2022-03-04 00:00:00',
                '2022-03-07 00:00:00',
                '2022-03-08 00:00:00',
                '2022-03-09 00:00:00',
                '2022-03-10 00:00:00',
            ]
        )

        self.sec_names = [ 
            'ABEV3.SA',
            'ALPA3.SA',
            'ITUB3.SA',
            'MGLU3.SA',
            'PETR3.SA',
            'VALE3.SA'
        ]
        
        self.secs_values = pd.DataFrame(
            [
                [14.69644833, 29.23548126, 23.64249992, 24.8819561, 18.19270515, 83.10849762],
                [14.52320957, 30.30290222, 23.71024132, 24.7820282, 18.73138428, 85.28993225],
                [14.46546268, 30.30290222, 23.61346626, 24.5521946, 18.52733994, 83.32236481],
                [14.72532177, 30.81684494, 23.83605385, 23.70281029, 18.9844017, 82.82619476],
                [14.48471165, 30.12499809, 23.52636528, 24.13249969, 18.69873619, 82.56099701],
                [14.84081364, 30.82672882, 24.17476845, 23.92265129, 19.29454994, 83.75009155],
                [14.72532177, 31.33079147, 24.26186943, 22.26385498, 18.74770927, 82.26158905],
                [15.01405334, 31.38020706, 24.2812252, 22.27384758, 19.1966095, 81.08103943],
                [14.95630646, 31.32090759, 24.39735413, 21.89412308, 18.83748817, 79.73795319],
                [14.51358414, 31.11335182, 23.98122025, 21.49441338, 18.40491104, 77.8986969],
                [14.24410152, 30.24360085, 23.71024132, 20.35523987, 18.38858795, 79.68663025],
                [14.42696476, 31.13311958, 24.05864143, 20.28528786, 18.73954391, 79.07926178],
                [14.58095455, 31.9336853, 24.48809804, 19.96552086, 19.01704788, 81.72263336],
                [14.72532177, 31.61741066, 24.25535764, 19.63575935, 19.30271149, 83.81853485],
                [15.00442886, 31.79531288, 24.71113957, 20.04546165, 19.24557877, 83.04005432],
                [14.71569729, 31.31102371, 24.40081776, 20.22533226, 19.53940582, 83.80997467],
                [14.43658924, 32.06216812, 23.80936673, 20.42518806, 19.27822685, 83.31380463],
                [14.69644833, 32.05228806, 23.93551114, 20.40520287, 19.4822731, 88.44660187],
                [14.81194115, 32.30925751, 23.67352345, 20.58507156, 19.33535957, 87.30027771],
                [14.64832592, 31.23195457, 23.66382077, 20.16537666, 19.42513847, 89.44749451],
                [14.86968708, 32.03252029, 23.43094685, 21.83416557, 19.09866714, 89.39617157],
                [14.7830677, 32.56623077, 23.3339124, 21.65429688, 19.1802845, 88.11296844],
                [14.92743397, 32.58599854, 23.75114682, 21.63430977, 19.3761692, 88.45515442],
                [15.04292679, 32.31914139, 23.76085141, 22.18391228, 19.3761692, 88.60914612],
                [15.21616554, 32.74413681, 24.00343182, 22.10397148, 19.68631935, 91.53482819],
                [15.27391148, 32.95168686, 24.00343182, 22.18391228, 20.13553687, 92.56994629],
                [15.20654106, 32.96157074, 24.13927319, 21.90411568, 19.90767737, 92.9634552],
                [15.13916969, 32.51681519, 23.91610768, 21.63430977, 20.86974974, 92.15932465],
                [15.03330135, 31.81508064, 23.77055791, 21.58434677, 20.37183447, 90.8162384],
                [15.30278492, 32.5069313, 23.76085141, 21.13467216, 20.38027258, 90.87612915],
                [15.25466347, 35.24466705, 23.93551114, 21.71425247, 20.43090887, 92.38173676],
                [15.00442886, 34.9876976, 23.81907513, 21.69426727, 20.45622702, 92.87791443],
                [14.71569729, 34.9876976, 23.54738477, 20.93481827, 19.9836299, 94.20388794],
                [14.63870144, 33.83132553, 24.49522028, 20.63503456, 20.66720648, 95.74372101],
                [14.68682384, 33.60400009, 23.94084749, 20.24531746, 20.27056189, 95.76938629],
                [14.37884235, 34.09817505, 23.91166697, 20.01548576, 20.28744193, 93.26287079],
                [14.24410152, 34.82956314, 24.27215456, 20.16537666, 20.2114894, 92.78381348],
                [14.09011173, 38.16030884, 23.37681841, 19.73568726, 19.76420851, 94.18677521],
                [14.30184746, 40.97711563, 23.98992418, 19.88557816, 20.54061766, 94.70861053],
                [15.57226849, 40.52247238, 23.67850756, 19.44589615, 20.26212378, 98.42133331],
                [15.60114002, 40.52247238, 23.98992418, 19.87558556, 20.98789854, 98.76351929],
                [15.88024807, 39.03993988, 24.39866137, 19.18608665, 21.24107237, 98.1133728],
                [16.23635101, 38.8422699, 24.27215456, 19.30599976, 21.51113005, 101.5608902],
                [16.23635101, 37.92310333, 23.92180704, 18.57652855, 21.2495143, 97.80539703],
                [16.24597549, 39.06959152, 24.64196467, 19.11613655, 21.46893378, 96.2313385],
                [16.53470802, 39.45504761, 25.02150606, 19.13612175, 22.43100424, 94.58029175],
                [16.74644279, 40.18643188, 25.14801859, 18.84633255, 22.68418189, 97.06114197],
                [16.76569176, 39.36610031, 25.12855219, 18.95625305, 22.39724799, 98.03636932],
                [16.90043449, 38.87192535, 25.36212038, 18.66646385, 22.32973357, 96.02603149],
                [16.88118553, 38.88180923, 25.61514734, 18.72641945, 22.03435965, 95.05079651],
                [16.9485569, 39.19807816, 25.58595347, 18.51657295, 22.24534293, 93.58795166],
                [16.96780396, 37.87368393, 25.67353891, 19.98550606, 22.46476241, 93.9130249],
                [16.9485569, 38.56553268, 25.58454546, 20.00549316, 22.07655783, 91.5776062],
                [16.81381416, 38.64459991, 25.85754999, 19.65574646, 22.27065916, 94.27232361],
                [17.02555084, 40.5125885, 25.76004823, 19.57580376, 22.10187598, 94.94813538],
                [17.17954254, 40.00852966, 26.00380167, 20.23532486, 23.33400221, 95.46141052],
                [17.27578545, 39.97887802, 26.09154924, 20.14538956, 23.28336592, 98.19035339],
                [18.06498528, 41.22420502, 26.85284135, 20.33525276, 23.77284117, 96.83872223],
                [18.64245033, 41.10560226, 27.56499574, 20.48514366, 24.91213675, 98.20746613],
                [18.65207291, 41.15501785, 28.05276582, 20.83489037, 25.20750876, 96.58207703],
                [18.86381149, 40.52247238, 28.63809869, 20.78492546, 25.03028365, 95.6410675],
                [18.8541851, 41.43175507, 28.4234762, 21.03474426, 25.61259146, 94.03279114],
                [18.58470154, 40.78932953, 28.83321092, 20.25531197, 25.69698401, 95.98325348],
                [18.59432602, 40.41375351, 28.87223337, 20.26530457, 25.7476203, 95.66673279],
                [18.22860146, 40.275383, 28.52103708, 20.36523056, 25.5197608, 97.81394958],
                [18.74831772, 41.01664734, 28.32592294, 20.57507896, 25.48600455, 97.28356171],
                [18.41146278, 41.5602417, 28.34543512, 20.87486076, 25.66322775, 95.38442993],
                [18.37296677, 41.5602417, 28.81369684, 20.29528046, 25.7476203, 92.51862335],
                [18.29597092, 42.4695282, 28.55029771, 21.29455757, 24.97965117, 90.59381866],
                [18.05536079, 42.27185822, 27.90643785, 21.05473137, 25.04716368, 93.32275391],
                [18.02648735, 42.4695282, 28.13081453, 21.25458717, 25.55351706, 94.19532776],
                [17.6030159, 42.48929596, 27.98447893, 20.95480347, 25.57883521, 95.29888153],
                [17.31428337, 41.11548233, 27.75034807, 20.56508636, 25.63790961, 96.72751617],
                [17.27578545, 42.0346489, 27.6723089, 21.63430977, 26.01767416, 99.04774037],
                [16.31334686, 41.52070618, 26.94064615, 21.37449837, 25.61259146, 100.2428774],
                [16.84268761, 42.79568481, 26.64797876, 21.51439857, 25.50288268, 98.67262593],
                [16.64057541, 43.00323868, 26.46262262, 21.65429688, 25.84045096, 100.3388323],
                [16.42883873, 42.59801102, 26.2870302, 21.13467216, 26.35524435, 100.9843859],
                [16.55395699, 42.91428757, 26.09216653, 20.67500687, 25.90796538, 99.26583425],
                [16.77531815, 43.97182465, 26.24834215, 21.62431717, 26.13582488, 101.2722582],
                [17.26616096, 44.12996292, 26.02384149, 21.36450577, 25.84889098, 100.9145922],
                [16.89080811, 44.92064285, 25.77981721, 21.08549369, 24.91213675, 101.4380068],
                [17.10254669, 46.06713104, 26.05312311, 22.02549423, 25.03872557, 101.7258867],
                [16.70794678, 45.56306839, 25.80909883, 21.93549408, 24.55768843, 101.3420519],
                [16.9966774, 45.15784454, 26.199535, 22.11549438, 24.80242796, 102.5720781],
                [17.13141823, 45.05901337, 26.23857461, 22.50549377, 24.89525862, 103.1652788],
                [17.23728752, 45.46423721, 26.44355928, 22.94549431, 24.73491354, 102.6156954],
                [16.95818138, 44.00147629, 25.91647111, 23.73549331, 24.16948576, 102.9297442],
                [16.77531815, 44.18926239, 25.59435998, 23.91549362, 23.72220679, 101.1152376],
                [16.37109184, 45.34563828, 25.35033189, 23.13549484, 23.45215102, 100.0335116],
                [16.39034271, 45.47412109, 25.78957712, 23.38549484, 23.82347746, 100.8535265],
                [16.55395699, 44.50553131, 25.83838235, 23.37549461, 24.194802, 101.9875979],
                [16.39034271, 44.17937851, 25.58459627, 23.265494, 24.22856017, 102.2493013],
                [16.12085915, 45.33575058, 25.52603303, 22.61549438, 23.91630812, 101.7433428],
                [16.44808769, 45.03924561, 25.94575273, 22.05549492, 24.38046523, 103.9067797],
                [16.28447342, 43.54683304, 26.199535, 21.46549476, 24.27919455, 101.7956804],
                [16.67907333, 44.4264679, 27.07802354, 21.54549469, 24.7095954, 104.517444],
                [16.48658371, 43.46776199, 27.28300439, 21.73549331, 24.61676283, 103.0082583],
                [16.01498985, 43.58636475, 27.02922021, 20.61549438, 24.00070067, 97.06749288],
                [16.22672653, 48.94324112, 27.29325891, 20.64549316, 23.78128119, 97.21579305],
                [16.42883873, 49.75368881, 27.51788354, 20.44549431, 24.16948576, 100.4522432],
                [16.00536537, 51.29552078, 26.71704698, 19.97549308, 23.3255622, 100.3475603],
                [15.99574184, 51.39435577, 26.97097421, 20.47549308, 25.49444266, 97.34664479],
                [16.45771217, 52.10597229, 27.52764917, 20.69549431, 25.35941763, 97.8875002],
                [16.51545906, 51.39435577, 27.72297502, 20.50549377, 25.13155623, 97.28557912],
                [16.08235931, 50.41588593, 27.36162401, 20.41549362, 25.13999625, 98.20154897],
                [15.94761848, 50.41588593, 27.65461183, 20.92549385, 25.5197608, 97.51239339],
                [15.95724392, 49.87229156, 27.18582941, 20.98549331, 25.65478774, 97.45132009],
                [16.02461433, 49.58566666, 27.49835039, 20.28549446, 26.04299231, 96.66620961],
                [15.78400421, 48.41941452, 27.24325408, 19.43549408, 25.56195708, 97.1023821],
                [15.70700932, 47.30257416, 27.28246154, 19.32549347, 27.18071818, 95.53213826],
                [15.85137463, 46.71944427, 27.3902954, 18.85549415, 26.88606142, 92.40037099],
                [16.5443325, 47.69791412, 27.11581458, 18.96549476, 26.65390658, 87.25344411],
                [16.88118553, 47.66826248, 27.26285971, 18.87549461, 26.64497828, 87.28834096],
                [16.70794678, 47.66826248, 27.52753104, 18.14549316, 27.45751642, 86.11065236],
                [16.92930794, 47.50024414, 28.09609069, 19.25549377, 27.74324488, 89.17263356],
                [16.91968346, 47.94500351, 28.3117546, 19.56549324, 27.80574869, 88.98943654],
                [16.46733665, 47.46071243, 27.851025, 18.81549324, 27.60038065, 87.88154164],
                [16.39996719, 49.05195999, 28.20392264, 19.04549469, 28.3682754, 90.027553],
                [16.53470802, 50.41588593, 28.1549076, 18.89549316, 28.04682993, 89.46924153],
                [16.45771217, 49.71415329, 28.3999771, 18.25549377, 27.3325107, 88.27410451],
                [16.61170197, 49.62520218, 28.9102793, 18.69549431, 27.19857668, 88.42240468],
                [15.89949799, 48.72580338, 27.79217627, 18.02549423, 26.769984, 88.15197316],
                [15.937994, 47.34210968, 27.30178168, 18.91549362, 26.7789123, 88.21303884],
                [16.5443325, 47.02583694, 27.90006545, 19.49549354, 26.84141611, 86.86088124],
                [15.60114002, 45.45435715, 26.42887786, 18.80549492, 25.48420786, 85.09871999],
                [15.69738483, 46.35375595, 26.81138709, 18.86549438, 25.6985042, 84.80211202],
                [15.49527264, 47.43106079, 26.6348429, 17.19549431, 25.6806457, 84.89807454],
                [15.73588276, 47.53977585, 26.97812178, 17.45549453, 26.40389513, 84.85445729],
                [15.82250214, 47.59908295, 26.76235106, 17.04549469, 26.2253158, 84.26996938],
                [15.41827774, 47.3322258, 26.399457, 16.63549484, 26.48425554, 82.21992818],
                [15.52414513, 48.00430298, 26.41907218, 16.38549484, 26.2610309, 78.89624349],
                [15.14879417, 47.70780182, 25.71290496, 16.58549369, 25.1716926, 77.34344045],
                [15.02367687, 46.93688583, 25.24212363, 16.06549324, 24.93060946, 74.37741414],
                [15.07179928, 46.89735031, 25.22251036, 16.40549339, 25.28777002, 75.57255116],
                [15.12954617, 47.61884689, 25.82078841, 16.35549415, 26.02887606, 78.18090383],
                [15.28353596, 46.81828308, 26.68388465, 15.88549389, 27.01106714, 86.3754878],
                [15.24503899, 46.73921204, 26.33080199, 15.64549411, 27.01106714, 85.20065259],
                [15.23541355, 47.18397522, 27.01735404, 15.02549423, 27.39501452, 86.26956128],
                [14.8600626, 44.45611954, 26.35041716, 14.19549431, 27.18071818, 82.46579694],
                [14.90818405, 43.42823029, 26.75253966, 13.95549358, 27.55573534, 83.38063001],
                [14.72532177, 43.66543579, 26.83100226, 14.35549415, 27.53787684, 83.80432843],
                [14.69644833, 44.56483841, 27.69485823, 14.56549419, 28.01111483, 83.76581525],
                [14.47508717, 42.98347092, 22.20919959, 13.72549404, 28.63614344, 83.08209943],
                [14.60982895, 40.1271286, 22.346584, 13.69549431, 29.07366633, 82.56208753],
                [14.53283405, 40.31492233, 22.48397605, 14.47549404, 28.421849, 84.59397077],
                [14.51358414, 39.52423859, 22.14050833, 14.04549373, 28.47542452, 86.80882215],
                [14.7830677, 39.53412247, 22.25826613, 14.98549427, 29.00223421, 87.28068494],
                [14.66757488, 39.53412247, 21.82647864, 14.39549411, 28.98437571, 88.98516034],
                [14.92743397, 40.45328903, 21.80685584, 14.515494, 29.45761179, 86.65474652],
                [14.90818405, 39.56376648, 21.64002768, 14.18549408, 29.41296839, 86.65474652],
                [14.94668198, 40.1271286, 22.05218474, 14.57549442, 29.33260607, 88.07995557],
                [15.03330135, 40.11724854, 22.30733458, 14.29549373, 29.36832308, 87.34809064],
                [14.57133102, 39.2277298, 21.73816077, 13.74549354, 28.18969416, 86.46215009],
                [14.83118916, 38.5556488, 22.30733458, 13.28549446, 28.74329256, 84.21841382],
                [14.57133102, 37.54753113, 22.01293723, 12.42549385, 27.81467699, 82.76431989],
                [14.43658924, 37.16207123, 21.20824019, 12.43549408, 27.3146522, 83.65026044],
                [14.69644833, 37.75508499, 21.67927901, 12.35549415, 28.84151339, 84.53619336],
                [14.59057999, 36.42080688, 21.48301474, 11.99549354, 28.53792643, 83.74655866],
                [14.64832592, 36.44057083, 21.551706, 11.61549438, 28.57364153, 82.08060407],
                [16.07273674, 35.89698029, 21.41432158, 11.16549362, 28.82365488, 81.35836744],
                [16.35184288, 33.39645004, 21.0021588, 10.82549442, 27.10928606, 79.34574842],
                [16.70794678, 34.0289917, 21.7639437, 11.31549419, 28.02897333, 80.02946424],
                [17.16029167, 35.43245316, 21.99965957, 11.56549419, 26.93963503, 74.74271344],
                [17.20841408, 34.69161042, 20.92910674, 11.09549392, 26.21638559, 74.01084851],
                [17.22766304, 34.72146424, 20.67374709, 12.45549358, 26.2342441, 72.1234126],
                [17.07367325, 33.6864415, 20.62463859, 11.94549431, 26.62711977, 75.48420667],
                [17.21803856, 34.49256714, 20.40855888, 13.14549411, 27.00213694, 73.88566541],
                [17.08329773, 34.69161042, 20.90946296, 13.03549446, 26.7967708, 73.64491986],
                [16.9485569, 35.51763733, 20.91928581, 13.66549362, 26.7967708, 75.87902784],
                [16.85231209, 35.51763733, 20.88982299, 11.16549362, 27.24322008, 76.15829419],
                [16.85231209, 34.57218369, 20.66392616, 9.755493771, 27.61823916, 74.26122617],
                [16.88118553, 34.57218369, 20.63445953, 9.285494458, 27.03785395, 72.98046445],
                [16.93893242, 36.08490952, 20.29070381, 9.005493771, 27.01999544, 70.40931653],
                [16.73681831, 36.00529297, 20.25141433, 9.285494458, 26.68069529, 72.04637479],
                [16.66944885, 34.69161042, 20.49064146, 8.855494153, 26.90391993, 75.47457074],
                [16.55395699, 34.14424332, 20.65981947, 8.615494381, 28.05576014, 77.18868207],
                [16.45771217, 33.67648896, 21.19721495, 8.835493695, 28.55578493, 78.73907422],
                [16.58282852, 35.08969315, 21.3763436, 8.715493809, 29.63619303, 78.27683973],
                [16.06311226, 34.67170533, 20.90861403, 8.07549442, 28.44863581, 76.48570203],
                [15.72625828, 33.58691986, 20.8290013, 8.055493962, 29.33260607, 77.31386518],
                [15.45677471, 32.94002732, 20.64986883, 7.815494191, 29.31474756, 77.74719953],
                [15.26428699, 33.57697113, 20.59545539, 6.895494114, 29.50225901, 78.01683759],
                [15.40865326, 32.09409722, 21.2428839, 6.775494229, 35.17323246, 81.1561427],
                [15.39902878, 32.51208695, 21.28272841, 7.065494191, 35.72323169, 79.59612226],
                [15.47602367, 32.7509404, 21.46201537, 7.315494191, 36.00323238, 83.35172986],
                [15.49527264, 33.44759186, 21.18312476, 7.635493886, 36.84323253, 83.89100598],
                [15.47602367, 34.06462296, 20.99387191, 6.825493943, 36.73323192, 83.3421092],
                [15.21616554, 34.57218369, 20.53569434, 6.29549421, 36.73323192, 82.78357648],
                [15.35090637, 34.58213623, 20.54565261, 6.385493886, 37.14323177, 83.23617505],
                [15.40865326, 33.08931168, 20.10739158, 6.065494191, 37.11323108, 85.36435651],
                [15.562644, 31.81543549, 20.19703505, 5.755493771, 36.67323246, 85.35472821],
                [15.47602367, 33.06940659, 20.14723037, 6.185494076, 36.57323208, 84.93102216],
                [15.49527264, 32.64146622, 20.3464434, 6.415494095, 37.21323147, 87.84884595],
                [15.46639919, 33.30826004, 19.89822028, 6.675493847, 36.44323292, 86.62585401],
                [16.02360008, 32.28318604, 19.66913054, 6.345493924, 35.85323276, 85.76880597],
                [16.00359962, 32.09409722, 19.59940932, 6.435494076, 35.99323215, 87.7525401],
                [15.99360034, 32.33294877, 19.77869628, 6.175493847, 35.87323131, 87.34809064],
                [16.15360019, 31.5666314, 19.85838149, 6.215493809, 36.09323253, 86.60659742],
                [16.13359973, 30.82022103, 20.03767035, 6.79549421, 36.69323292, 86.41400098],
                [16.12360046, 31.29792603, 19.96794532, 6.845493924, 36.71323147, 84.5843501],
                [16.05359981, 31.53677758, 19.90818236, 6.775494229, 36.60323276, 84.77693891],
                [16.02360008, 31.09888085, 19.67909263, 7.23549379, 36.35323276, 85.46065473],
                [15.93359992, 31.37552254, 20.00345954, 6.73549379, 37.17323246, 85.49917554],
                [15.91360042, 31.19552224, 20.43215522, 6.625494134, 37.57323208, 84.61323499],
                [15.61360023, 28.43552392, 20.03336868, 6.435494076, 36.26323261, 85.3162074],
                [15.37360046, 28.52552216, 20.38230667, 6.265494, 36.23323192, 86.82807874],
                [15.13359973, 29.36552231, 20.69136772, 6.23549379, 36.48323192, 91.27703809],
                [15.25359962, 28.395523, 20.80103454, 5.755493771, 36.37323131, 90.31406354],
                [15.28360031, 27.92552369, 21.09015617, 5.885493886, 37.64323177, 91.8355708],
                [15.48360011, 29.145523, 21.10012588, 6.325493943, 38.70323124, 92.72151136],
                [15.59359977, 28.83552353, 21.35933837, 6.105494153, 39.50323047, 91.46963452],
                [15.70360038, 28.10552208, 21.36930809, 6.345493924, 40.21323337, 91.94149732],
                [15.40360019, 27.33552353, 21.30948982, 6.135493886, 40.10323276, 91.51778363],
                [15.18359992, 26.10552208, 21.43909416, 5.905493866, 40.22323169, 93.50151776],
                [15.14359996, 26.47552292, 21.27957878, 6.325493943, 39.903232, 95.33117627],
                [15.09359977, 28.12552254, 21.10012588, 6.665494095, 40.12323322, 93.88671064],
                [15.29359958, 26.66552346, 21.11009368, 6.915494095, 40.24323215, 92.15335797],
                [15.30359981, 25.40552323, 21.10012588, 6.405493866, 40.30323353, 91.15185498],
                [15.67359969, 25.395523, 21.74815521, 6.73549379, 41.45323124, 91.33481549],
                [15.6036, 25.20552247, 21.94754943, 6.765494, 42.50323047, 91.56594037],
                [16.00359962, 26.55552285, 22.10706672, 7.23549379, 42.64323368, 91.74890088],
                [15.53360031, 26.36552231, 22.36627731, 6.725494038, 41.54323139, 90.94963025],
                [15.57360027, 26.41552346, 22.70524559, 7.015494, 40.92323246, 88.26292371],
                [15.45360038, 24.65552323, 22.96999069, 7.025494229, 41.96323337, 92.53854322],
                [15.12360046, 25.01552384, 22.68064018, 6.525494229, 41.31323185, 93.00077008],
                [15.06360004, 24.72552292, 22.86023613, 6.54549421, 40.93323078, 92.96224927],
                [15.01359985, 24.38552277, 22.98994728, 6.345493924, 41.56323185, 95.12895154],
                [14.89359996, 24.145523, 22.88019272, 6.325493943, 41.13323154, 97.18009137],
                [14.76359985, 23.95552247, 23.02985855, 6.555493962, 40.62323322, 98.39344739],
                [15.14359996, 24.895523, 22.14184471, 6.615493905, 40.653232, 98.41271161],
                [15.3536, 24.79552262, 22.4212217, 6.955494057, 41.25323047, 100.781631],
                [15.46359966, 24.04552262, 23.50878617, 6.365493905, 42.85323276, 98.95197248],
                [15.66360042, 24.79552262, 23.32919022, 6.495494019, 41.89323368, 98.56677961],
                [15.98360011, 25.17552369, 23.5886068, 6.855494153, 41.14323368, 95.94747876],
                [15.68359992, 24.79552262, 23.48883148, 6.835494172, 41.92323246, 96.57341718],
                [15.45360038, 25.09552376, 23.07974716, 6.645494114, 41.75323047, 92.86595868],
                [15.37360046, 24.895523, 23.18950173, 6.375494134, 41.52323093, 93.0392909],
                [15.05359981, 24.18552392, 22.74050614, 6.035493981, 42.49323215, 93.10670423],
                [15.31360004, 24.78552239, 22.89759303, 6.085494172, 41.92323246, 94.54153394],
                [15.41360042, 23.645523, 22.63801433, 5.925493847, 41.93323078, 93.65560102],
                [15.44360015, 21.48552315, 22.18874217, 6.135493886, 41.36323108, 94.68598127],
                [15.80359981, 22.145523, 22.50822497, 6.025494229, 42.02323093, 99.25049543],
                [15.12360046, 22.48552315, 22.15382564, 6.325493943, 43.17323246, 106.3476481],
                [14.78360031, 22.09552376, 22.18881153, 6.325493943, 42.87323322, 106.3957896],
                [14.53360031, 21.51552384, 21.76881146, 6.305493962, 42.62323322, 108.5817561],
                [14.03360031, 19.49552338, 21.29881024, 5.865493905, 39.79323139, 111.5669856],
                [14.04359958, 19.69552224, 21.248811, 6.065494191, 40.34323063, 107.1276545],
                [14.57360027, 21.04552262, 22.17881131, 6.265494, 40.01323261, 108.3061619],
                [13.98360011, 20.79552262, 22.01881146, 5.975494038, 41.30323353, 111.4061681],

            ],
            columns = self.sec_names,
            index = self.date_idx
        )
    
        self.pf = portfolio.Portfolio(securities_values = self.secs_values, individual = True)
        self.pf_total = portfolio.Portfolio(securities_values = self.secs_values)

    def test_instantiation_portfolio_param(self):
        optim = portfolio.Optimization(portfolio = self.pf)
        print(optim.volmodel.logreturns)
        self.assertTrue(
            isinstance(optim._risk_return, pd.DataFrame),
            msg = f"Instantiation for 'Optimization' class ('portfolio' param) failed."
        )

    def test_instantiation_portfolio_param_no_individual(self):
        with self.assertRaises(TypeError,
            msg = f"Instantiation for 'Optimization' class (invalid 'portfolio' param) succeded (should've failed)"
        ):
            optim = portfolio.Optimization(portfolio = self.pf_total)

    def test_instantiation_secs_values_param(self):
        optim = portfolio.Optimization(securities_values = self.secs_values)
        self.assertTrue(
            isinstance(optim._risk_return, pd.DataFrame),
            msg = f"Instantiation for 'Optimization' class ('securities_values' param) failed."
        )

